{% extends "base.html" %}

{% block title %}Biodiversity Status - ForesToFuture{% endblock %}

{% block extra_css %}
<!-- Use the deforestation CSS to match the design -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/deforestation.css') }}">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

<style>
/* Additional tweaks specific for biodiversity page */
.biodiversity-header {
    background: linear-gradient(135deg, #2d5016 0%, #3a6b1f 100%);
    padding: 40px;
    border-radius: 15px;
    text-align: center;
    margin-bottom: 30px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

.biodiversity-header h1 {
    font-size: 2.5em;
    color: #dff8df;
}

.biodiversity-header p {
    font-size: 1.2em;
    color: rgba(255,255,255,0.9);
}

/* Chart container styling like deforestation */
.chart-container {
    position: relative;
    height: 500px;
    margin-bottom: 40px;
    background: rgba(255,255,255,0.95);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.country-selector {
    margin-bottom: 30px;
    text-align: center;
}

    .country-selector select {
        padding: 12px 20px;
        font-size: 1em;
        border: 2px solid #3a6b1f;
        border-radius: 8px;
        background: rgba(255,255,255,0.9);
        cursor: pointer;
        min-width: 200px;
        transition: all 0.3s;
        color: #2d5016;
        font-weight: bold;
    }


.country-selector select:hover {
    border-color: #3a6b1f;
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}

.loading {
    text-align: center;
    font-size: 1.2em;
    color: #4caf50;
    margin-top: 20px;
}

@media (max-width: 768px) {
    .chart-container {
        height: 350px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="content">
    <div class="biodiversity-header">
        <h1>ðŸŒ¿ Biodiversity Status</h1>
        <p>Wildlife & Ecosystem Health Analysis (2016â€“2025)</p>
    </div>

    <div class="country-selector">
        <label for="countrySelect">Select Country:</label>
        <select id="countrySelect" onchange="loadCountryData()">
            <option value="">Select Country</option>
            {% for country in countries %}
                <option value="{{ country }}">{{ country }}</option>
            {% endfor %}
        </select>
    </div>

    <div id="loadingMessage" class="loading">Please select a country to load data...</div>

    <div class="chart-container" style="display:none;">
        <canvas id="biodiversityBar"></canvas>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let barChart = null;

function loadCountryData() {
    const country = document.getElementById('countrySelect').value;
    if (!country) return;

    document.getElementById('loadingMessage').textContent = 'Loading data...';
    document.getElementById('loadingMessage').style.display = 'block';
    document.querySelector('.chart-container').style.display = 'none';

    fetch(`/api/biodiversity/${country}`)
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                document.getElementById('loadingMessage').textContent = data.error;
                return;
            }

            const ctx = document.getElementById('biodiversityBar').getContext('2d');

            if (barChart) barChart.destroy();

            barChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.years,
                    datasets: [
                        {
                            label: 'Affected Species',
                            data: data.affected_species,
                            backgroundColor: 'rgba(231, 76, 60, 0.8)'
                        },
                        {
                            label: 'Ecosystem Health Index',
                            data: data.ecosystem_health_index,
                            backgroundColor: 'rgba(46, 204, 113, 0.8)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: `${country} - Biodiversity Status (2016â€“2025)`,
                            font: { size: 20, weight: 'bold' },
                            color: '#2d5016'
                        },
                        legend: {
                            position: 'top',
                            labels: { font: { size: 14, weight: 'bold' }, color: '#2d5016' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Count / Index',
                                color: '#2d5016',
                                font: { size: 16, weight: 'bold' }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Year',
                                color: '#2d5016',
                                font: { size: 16, weight: 'bold' }
                            }
                        }
                    }
                }
            });

            document.getElementById('loadingMessage').style.display = 'none';
            document.querySelector('.chart-container').style.display = 'block';
        })
        .catch(err => {
            console.error(err);
            document.getElementById('loadingMessage').textContent = 'Error loading data.';
        });
}
</script>
{% endblock %}
